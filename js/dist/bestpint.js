"use strict";var Bestpint=Bestpint||{};Bestpint.config=function(){this.entries={},this.device_lat=0,this.device_long=0,this.fakeloader=$("#fakeloader"),this.map_wrapper=$("#map-canvas"),this.proxy_error_wrapper=$("#proxy-error"),this.fakeloader.fakeLoader({timeToHide:1e6,bgColor:"#333",spinner:"spinner1"})};var Bestpint=Bestpint||{};Bestpint.createInfoWindowContent=function(e){var t=e,r="";return(void 0===t.ecplus_Beer_ctrl7||t.ecplus_Beer_ctrl7.indexOf("thumbnail=true")>-1)&&(t.ecplus_Beer_ctrl7="img/placeholder.png"),r+='<table class="infoWindow table-striped table-bordered table-condensed">',r+='<thead><tr><th colspan="2" class="text-center">'+(t.ecplus_Beer_ctrl6||"")+"</th></tr></thead>",r+="<tbody>",r+="<tr>",r+="<td>"+Bestpint.project.ecplus_Beer_ctrl13+"</td>",r+="<td>"+(t.ecplus_Beer_ctrl13||"")+"</td>",r+="</tr>",r+="<tr>",r+="<td>"+Bestpint.project.ecplus_Place_ctrl4.key+"</td>",r+="<td>"+(Bestpint.project.ecplus_Place_ctrl4.values[t.ecplus_Place_ctrl4]||"")+"</td>",r+="</tr>",r+="<tr>",r+="<td>"+Bestpint.project.ecplus_Beer_ctrl6+"</td>",r+="<td>"+(t.ecplus_Beer_ctrl6||"")+"</td>",r+="</tr>",r+="<tr>",r+="<td>"+Bestpint.project.ecplus_Beer_ctrl8+"</td>",r+="<td>"+(t.ecplus_Beer_ctrl8||"")+"</td>",r+="</tr>",r+="<tr>",r+="<td>"+Bestpint.project.ecplus_Beer_ctrl9.key+"</td>",r+="<td>"+(Bestpint.project.ecplus_Beer_ctrl9.values[t.ecplus_Beer_ctrl9]||"")+"</td>",r+="</tr>",r+='<tr colspan="2">',r+='<tr><td colspan="2" class="img-wrapper">',r+='<div class="desktop-frame-square">',r+='<div class="crop">',r+='<i class="fa fa-spinner fa-spin fa-3x"></i>',r+='<img src="'+t.ecplus_Beer_ctrl7+'" alt="" title="" width="200">',r+="</div>",r+="</div>",r+="</td></tr>",r+="</tr>",r+="<tr>",r+="<td>"+Bestpint.project.ecplus_Beer_ctrl14.key+"</td>",r+="<td>"+(Bestpint.project.ecplus_Beer_ctrl14.values[t.ecplus_Beer_ctrl14]||"")+"</td>",r+="</tr>",r+="<tr>",r+="<td>"+Bestpint.project.ecplus_Beer_ctrl11.key+"</td>",r+="<td>"+(Bestpint.project.ecplus_Beer_ctrl11.values[t.ecplus_Beer_ctrl11]||"")+"</td>",r+="</tr>",r+="<tr>",r+="<td>"+Bestpint.project.ecplus_Beer_ctrl12+"</td>",r+="<td>"+(t.ecplus_Beer_ctrl12||"")+"</td>",r+="</tr>",r+="<tr>",r+="<td>"+Bestpint.project.ecplus_Place_ctrl5+"</td>",r+="<td>"+(t.ecplus_Place_ctrl5||"")+"</td>",r+="</tr>",r+="</tbody>",r+="</table>"};var Bestpint=Bestpint||{};Bestpint.createMobileInfoContent=function(e){var t=e,r="";return(void 0===t.ecplus_Beer_ctrl7||t.ecplus_Beer_ctrl7.indexOf("thumbnail=true")>-1||""===t.ecplus_Beer_ctrl7)&&(t.ecplus_Beer_ctrl7="img/placeholder.png"),r+='<table class="mobile-info-window table-condensed table-bordered table-striped">',r+='<thead><tr><th colspan="2" class="text-center">'+(t.ecplus_Beer_ctrl6||"")+", "+(t.ecplus_Beer_ctrl13||"")+"</th></tr></thead>",r+="<tbody>",r+="<tr>",r+="<td>"+Bestpint.project.ecplus_Beer_ctrl14.key+"</td>",r+="<td>"+(Bestpint.project.ecplus_Beer_ctrl14.values[t.ecplus_Beer_ctrl14]||"")+"</td>",r+="</tr>",r+="<tr>",r+="<td>"+Bestpint.project.ecplus_Beer_ctrl11.key+"</td>",r+="<td>"+(Bestpint.project.ecplus_Beer_ctrl11.values[t.ecplus_Beer_ctrl11]||"")+"</td>",r+="</tr>",r+='<tr><td colspan="2" class="img-wrapper">',r+='<div class="frame-square">',r+='<div class="crop">',r+='<i class="fa fa-spinner fa-spin fa-3x"></i>',r+='<img src="'+t.ecplus_Beer_ctrl7+'" alt="" title="small wide image">',r+="</div>",r+="</div>",r+="</td></tr>",r+="</tbody>",r+="</table>"};var Bestpint=Bestpint||{};Bestpint.getData=function(){var e=new $.Deferred;return $.getJSON("http://query.yahooapis.com/v1/public/yql",{q:"select * from json where url='http://plus.epicollect.net/Bestpint/Beer.json'",format:"json"},function(t,r){t.query.results?e.resolve(t.query.results.json.json):e.reject(r)}),e.promise()};var Bestpint=Bestpint||{};Bestpint.init=function(){$.when(Bestpint.getData()).then(function(e){Bestpint.entries=e,Bestpint.isMobile.any()?navigator.geolocation.getCurrentPosition(function(e){Bestpint.device_lat=e.coords.latitude,Bestpint.device_long=e.coords.longitude,Bestpint.initialiseMap()},function(e){console.log(e),Bestpint.initialiseMap()}):Bestpint.initialiseMap()},function(e){console.log(e),Bestpint.map_wrapper.hide(),Bestpint.proxy_error_wrapper.removeClass("hidden"),Bestpint.fakeloader.fadeOut()})};var Bestpint=Bestpint||{};Bestpint.initialiseMap=function(){function e(){var e,c,o,s=Bestpint.entries.length,p=[];for(n=new L.MarkerClusterGroup({showCoverageOnHover:!1,maxClusterRadius:10}),e=0;s>e;e++)""!==Bestpint.entries[e].ecplus_Place_ctrl3.latitude&&(c=L.marker([Bestpint.entries[e].ecplus_Place_ctrl3.latitude,Bestpint.entries[e].ecplus_Place_ctrl3.longitude],{icon:l}),i?c.bindPopup(Bestpint.createMobileInfoContent(Bestpint.entries[e]),{closeButton:!1}):c.bindPopup(Bestpint.createInfoWindowContent(Bestpint.entries[e])),p.push([Bestpint.entries[e].ecplus_Place_ctrl3.latitude,Bestpint.entries[e].ecplus_Place_ctrl3.longitude]),n.addLayer(c));i&&Bestpint.device_lat&&Bestpint.device_long?(o=L.marker([Bestpint.device_lat,Bestpint.device_long]),o.addTo(t),t.fitBounds([[Bestpint.device_lat,Bestpint.device_long]],{padding:[100,100]}),t.setZoom(12,{animate:!0})):t.fitBounds(p,{padding:[50,50]}),t.addLayer(n),r.on("load",function(){console.log("all visible tiles have been loaded"),Bestpint.fakeloader.fadeOut()})}var t,r,n,i=Bestpint.isMobile.any(),c={center:{lat:0,lng:0},zoom:6,zoomControl:i?!1:!0},l=L.icon({iconUrl:"img/marker-icon.png",iconSize:[32,32],iconAnchor:[16,16]});i&&Bestpint.map_wrapper.height("100vh"),L.Icon.Default.imagePath="./img/leaflet/",t=L.map("map-canvas",c),r=L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(t),t.on("popupopen",function(e){var r=t.project(e.popup._latlng);r.y-=e.popup._container.clientHeight/2,t.panTo(t.unproject(r),{animate:!0})}),e()};var Bestpint=Bestpint||{};Bestpint.isMobile={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return this.Android()||this.BlackBerry()||this.iOS()||this.Opera()||this.Windows()}};var Bestpint=Bestpint||{};Bestpint.project={created:"",ecplus_Beer_ctrl6:"Name of beer",ecplus_Beer_ctrl7:"Take a photo of the beer",ecplus_Beer_ctrl8:"Brewery",ecplus_Beer_ctrl9:{key:"Type of beer",values:{1:"Ale",2:"Pale Ale",3:"IPA",4:"Porter",5:"Stout",6:"Other"}},ecplus_Beer_ctrl11:{key:"How is the price range?",values:{1:"Expensive",2:"Average",3:"Cheap"}},ecplus_Beer_ctrl12:"Price and currency?",ecplus_Beer_ctrl13:"Name of the place?",ecplus_Beer_ctrl14:{key:"How would you rate it?",values:{1:"Excellent",2:"Good",3:"Average",4:"Fair",5:"Poor"}},ecplus_Place_ctrl3:"Location",ecplus_Place_ctrl4:{key:"Type of Place",values:{1:"Pub",2:"Bar",3:"Festival",4:"Exhibition",5:"Brewery",6:"Other"}},ecplus_Place_ctrl5:"Any comments?"};var Bestpint=Bestpint||{};$(document).ready(function(){var e=window.location.href;"map"===e.split("/").pop()&&(console.log("Let 's display some map"),Bestpint.config(),Bestpint.init())}),function(){function e(){clearTimeout(u),clearTimeout(d),clearTimeout(B)}function t(){(document.webkitHidden||document.hidden)&&(e(),document.location="http://bestpint.net")}function r(){var e=document.createElement("iframe");e.style.border="none",e.style.width="1px",e.style.height="1px",e.onload=function(){document.location=p},e.src=s,document.body.appendChild(e)}function n(){document.location="epicollectplus://project?plus.epicollect.net/bestpint.xml",u=setTimeout(function(){document.location=p},2e3)}function i(){document.location=p}function c(){document.location=p}function l(){n()}function o(e){d=setInterval(t,200),navigator.userAgent.match(/Chrome/)?navigator.userAgent.match(/Opera|OPR\//)?i():l():(navigator.userAgent.match(/Firefox/)||navigator.userAgent.match(/Opera/))&&navigator.userAgent.match(/Firefox/)?c():(n(),B=setTimeout(function(){r()},1500))}var s="epicollectplus://view?project="+encodeURI("http://plus.epicollect.net/bestpint.xml"),p=("epicollectplus://project="+encodeURI("plus.epicollect.net/bestpint.xml"),"https://play.google.com/store/apps/details?id=uk.ac.imperial.epicollectplus.html5&hl=en_GB&referrer="+encodeURI("http://plus.epicollect.net/bestpint.xml")),a="intent:#Intent;action=uk.ac.imperial.epicollectplus.html5.REQUEST_PROJECT;S.project=";a+=encodeURI("http://plus.epicollect.net/bestpint.xml"),a+=";S.referrer=",a+=encodeURI("http://plus.epicollect.net/bestpint.xml"),a+=";package=uk.ac.imperial.epicollectplus.html5;launchFlags=268435456;end";var u,d,B;$(".source_url").click(function(e){BestPint.isMobile.Android()?o($(this)):BestPint.isMobile.iOS()&&(setTimeout(function(){window.location="itms://itunes.apple.com/us/app/kaon-v-stream/id378890806?mt=8&uo=4"},25),document.location="epicollectplus://project?plus.epicollect.net/bestpint.xml"),e.preventDefault()})}();
//# sourceMappingURL=bestpint.js.map