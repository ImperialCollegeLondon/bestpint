$(document).ready(function(){"use strict";function e(e){var t=e,r="";return(void 0===t.ecplus_Beer_ctrl7||t.ecplus_Beer_ctrl7.indexOf("thumbnail=true")>-1)&&(t.ecplus_Beer_ctrl7="img/placeholder.png"),r+='<table class="infoWindow table-striped table-bordered table-condensed">',r+='<thead><tr><th colspan="2" class="text-center">'+(t.ecplus_Beer_ctrl6||"")+"</th></tr></thead>",r+="<tbody>",r+="<tr>",r+="<td>"+_.ecplus_Beer_ctrl13+"</td>",r+="<td>"+(t.ecplus_Beer_ctrl13||"")+"</td>",r+="</tr>",r+="<tr>",r+="<td>"+_.ecplus_Place_ctrl4.key+"</td>",r+="<td>"+(_.ecplus_Place_ctrl4.values[t.ecplus_Place_ctrl4]||"")+"</td>",r+="</tr>",r+="<tr>",r+="<td>"+_.ecplus_Beer_ctrl6+"</td>",r+="<td>"+(t.ecplus_Beer_ctrl6||"")+"</td>",r+="</tr>",r+="<tr>",r+="<td>"+_.ecplus_Beer_ctrl8+"</td>",r+="<td>"+(t.ecplus_Beer_ctrl8||"")+"</td>",r+="</tr>",r+="<tr>",r+="<td>"+_.ecplus_Beer_ctrl9.key+"</td>",r+="<td>"+(_.ecplus_Beer_ctrl9.values[t.ecplus_Beer_ctrl9]||"")+"</td>",r+="</tr>",r+='<tr colspan="2">',r+='<tr><td colspan="2" class="img-wrapper">',r+='<div class="desktop-frame-square">',r+='<div class="crop">',r+='<i class="fa fa-spinner fa-spin fa-3x"></i>',r+='<img src="'+t.ecplus_Beer_ctrl7+'" alt="" title="" width="200">',r+="</div>",r+="</div>",r+="</td></tr>",r+="</tr>",r+="<tr>",r+="<td>"+_.ecplus_Beer_ctrl14.key+"</td>",r+="<td>"+(_.ecplus_Beer_ctrl14.values[t.ecplus_Beer_ctrl14]||"")+"</td>",r+="</tr>",r+="<tr>",r+="<td>"+_.ecplus_Beer_ctrl11.key+"</td>",r+="<td>"+(_.ecplus_Beer_ctrl11.values[t.ecplus_Beer_ctrl11]||"")+"</td>",r+="</tr>",r+="<tr>",r+="<td>"+_.ecplus_Beer_ctrl12+"</td>",r+="<td>"+(t.ecplus_Beer_ctrl12||"")+"</td>",r+="</tr>",r+="<tr>",r+="<td>"+_.ecplus_Place_ctrl5+"</td>",r+="<td>"+(t.ecplus_Place_ctrl5||"")+"</td>",r+="</tr>",r+="</tbody>",r+="</table>"}function t(e){var t=e,r="";return(void 0===t.ecplus_Beer_ctrl7||t.ecplus_Beer_ctrl7.indexOf("thumbnail=true")>-1||""===t.ecplus_Beer_ctrl7)&&(t.ecplus_Beer_ctrl7="img/placeholder.png"),r+='<table class="mobile-info-window table-condensed table-bordered table-striped">',r+='<thead><tr><th colspan="2" class="text-center">'+(t.ecplus_Beer_ctrl6||"")+", "+(t.ecplus_Beer_ctrl13||"")+"</th></tr></thead>",r+="<tbody>",r+="<tr>",r+="<td>"+_.ecplus_Beer_ctrl14.key+"</td>",r+="<td>"+(_.ecplus_Beer_ctrl14.values[t.ecplus_Beer_ctrl14]||"")+"</td>",r+="</tr>",r+="<tr>",r+="<td>"+_.ecplus_Beer_ctrl11.key+"</td>",r+="<td>"+(_.ecplus_Beer_ctrl11.values[t.ecplus_Beer_ctrl11]||"")+"</td>",r+="</tr>",r+='<tr><td colspan="2" class="img-wrapper">',r+='<div class="frame-square">',r+='<div class="crop">',r+='<i class="fa fa-spinner fa-spin fa-3x"></i>',r+='<img src="'+t.ecplus_Beer_ctrl7+'" alt="" title="small wide image">',r+="</div>",r+="</div>",r+="</td></tr>",r+="</tbody>",r+="</table>"}function r(){function r(){var r,o,d,_=c.length,h=[];for(u=new L.MarkerClusterGroup({showCoverageOnHover:!1,maxClusterRadius:10}),r=0;_>r;r++)""!==c[r].ecplus_Place_ctrl3.latitude&&(o=L.marker([c[r].ecplus_Place_ctrl3.latitude,c[r].ecplus_Place_ctrl3.longitude],{icon:m}),i?o.bindPopup(t(c[r]),{closeButton:!1}):o.bindPopup(e(c[r])),h.push([c[r].ecplus_Place_ctrl3.latitude,c[r].ecplus_Place_ctrl3.longitude]),u.addLayer(o));i&&a&&s?(d=L.marker([a,s]),d.addTo(n),n.fitBounds([[a,s]],{padding:[100,100]}),n.setZoom(12,{animate:!0})):n.fitBounds(h,{padding:[50,50]}),n.addLayer(u),p.on("load",function(){console.log("all visible tiles have been loaded"),l.fadeOut()})}i&&$("#map-canvas").height("100vh"),o={center:{lat:0,lng:0},zoom:6,zoomControl:i?!1:!0},L.Icon.Default.imagePath="./img/leaflet/",n=L.map("map-canvas",o),p=L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(n),n.on("popupopen",function(e){var t=n.project(e.popup._latlng);t.y-=e.popup._container.clientHeight/2,n.panTo(n.unproject(t),{animate:!0})}),r()}console.log("Let 's display some map");var l,c,n,o,i,a,s,u,p,d={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return d.Android()||d.BlackBerry()||d.iOS()||d.Opera()||d.Windows()}},_={created:"",ecplus_Beer_ctrl6:"Name of beer",ecplus_Beer_ctrl7:"Take a photo of the beer",ecplus_Beer_ctrl8:"Brewery",ecplus_Beer_ctrl9:{key:"Type of beer",values:{1:"Ale",2:"Pale Ale",3:"IPA",4:"Porter",5:"Stout",6:"Other"}},ecplus_Beer_ctrl11:{key:"How is the price range?",values:{1:"Expensive",2:"Average",3:"Cheap"}},ecplus_Beer_ctrl12:"Price and currency?",ecplus_Beer_ctrl13:"Name of the place?",ecplus_Beer_ctrl14:{key:"How would you rate it?",values:{1:"Excellent",2:"Good",3:"Average",4:"Fair",5:"Poor"}},ecplus_Place_ctrl3:"Location",ecplus_Place_ctrl4:{key:"Type of Place",values:{1:"Pub",2:"Bar",3:"Festival",4:"Exhibition",5:"Brewery",6:"Other"}},ecplus_Place_ctrl5:"Any comments?"},m=L.icon({iconUrl:"img/marker-icon.png",iconSize:[32,32],iconAnchor:[16,16]});l=$("#fakeloader"),l.fakeLoader({timeToHide:1e6,bgColor:"#333",spinner:"spinner1"}),$("#proxy-error").hide(),i=d.any(),$.getJSON("http://query.yahooapis.com/v1/public/yql",{q:"select * from json where url='http://plus.epicollect.net/Bestpint/Beer.json'",format:"json"},function(e,t){if(console.log(t),e.query.results){c=e.query.results.json.json,console.log(e.query.results.json.json);if(i){var n=function(e){a=e.coords.latitude,s=e.coords.longitude,r()},o=function(e){console.log(e),r()};navigator.geolocation.getCurrentPosition(n,o)}else r()}else $("#map-canvas").hide(),$("#proxy-error").removeClass("hidden"),l.fadeOut()})}),function(){"use strict";function e(){clearTimeout(p),clearTimeout(d),clearTimeout(_)}function t(){(document.webkitHidden||document.hidden)&&(e(),document.location="http://bestpint.net")}function r(){var e=document.createElement("iframe");e.style.border="none",e.style.width="1px",e.style.height="1px",e.onload=function(){document.location=s},e.src=a,document.body.appendChild(e)}function l(){document.location="epicollectplus://project?plus.epicollect.net/bestpint.xml",p=setTimeout(function(){document.location=s},2e3)}function c(){document.location=s}function n(){document.location=s}function o(){l()}function i(e){d=setInterval(t,200),navigator.userAgent.match(/Chrome/)?navigator.userAgent.match(/Opera|OPR\//)?c():o():(navigator.userAgent.match(/Firefox/)||navigator.userAgent.match(/Opera/))&&navigator.userAgent.match(/Firefox/)?n():(l(),_=setTimeout(function(){r()},1500))}var a="epicollectplus://view?project="+encodeURI("http://plus.epicollect.net/bestpint.xml"),s=("epicollectplus://project="+encodeURI("plus.epicollect.net/bestpint.xml"),"https://play.google.com/store/apps/details?id=uk.ac.imperial.epicollectplus.html5&hl=en_GB&referrer="+encodeURI("http://plus.epicollect.net/bestpint.xml")),u="intent:#Intent;action=uk.ac.imperial.epicollectplus.html5.REQUEST_PROJECT;S.project=";u+=encodeURI("http://plus.epicollect.net/bestpint.xml"),u+=";S.referrer=",u+=encodeURI("http://plus.epicollect.net/bestpint.xml"),u+=";package=uk.ac.imperial.epicollectplus.html5;launchFlags=268435456;end";var p,d,_;$(".source_url").click(function(e){BestPint.isMobile.Android()?i($(this)):BestPint.isMobile.iOS()&&(setTimeout(function(){window.location="itms://itunes.apple.com/us/app/kaon-v-stream/id378890806?mt=8&uo=4"},25),document.location="epicollectplus://project?plus.epicollect.net/bestpint.xml"),e.preventDefault()})}();var BestPint=BestPint||{};BestPint=function(e){"use strict";return e.isMobile={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return this.Android()||this.BlackBerry()||this.iOS()||this.Opera()||this.Windows()}},e}(BestPint);
//# sourceMappingURL=bestpint.js.map