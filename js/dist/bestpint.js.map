{"version":3,"sources":["Bestpint.config.js","Bestpint.createInfoWindowContent.js","Bestpint.createMobileInfoContent.js","Bestpint.getData.js","Bestpint.init.js","Bestpint.initialiseMap.js","Bestpint.isMobile.js","Bestpint.project.js","app.js","custom_url.js"],"names":["Bestpint","config","this","entries","device_lat","device_long","fakeloader","$","map_wrapper","proxy_error_wrapper","fakeLoader","timeToHide","bgColor","spinner","createInfoWindowContent","the_entry","entry","html","undefined","ecplus_Beer_ctrl7","indexOf","ecplus_Beer_ctrl6","project","ecplus_Beer_ctrl13","ecplus_Place_ctrl4","key","values","ecplus_Beer_ctrl8","ecplus_Beer_ctrl9","ecplus_Beer_ctrl14","ecplus_Beer_ctrl11","ecplus_Beer_ctrl12","ecplus_Place_ctrl5","createMobileInfoContent","getData","deferred","Deferred","getJSON","q","format","data","status","query","results","resolve","json","reject","promise","init","when","then","response","isMobile","any","navigator","geolocation","getCurrentPosition","position","coords","latitude","longitude","initialiseMap","error","console","log","hide","removeClass","fadeOut","addMarkers","i","marker","iLength","length","cluster","L","MarkerClusterGroup","showCoverageOnHover","maxClusterRadius","ecplus_Place_ctrl3","icon","image","is_device","bindPopup","closeButton","push","addLayer","addTo","map","fitBounds","padding","setZoom","animate","tiles","on","map_options","center","lat","lng","zoom","zoomControl","iconUrl","iconSize","iconAnchor","height","Icon","Default","imagePath","tileLayer","attribution","e","px","popup","_latlng","y","_container","clientHeight","panTo","unproject","Android","userAgent","match","BlackBerry","iOS","Opera","Windows","created",1,2,3,4,5,6,"document","ready","href","window","location","split","pop","clearTimers","clearTimeout","timer","heartbeat","iframe_timer","intervalHeartbeat","webkitHidden","hidden","tryIframeApproach","iframe","createElement","style","border","width","onload","alt","src","custom","body","appendChild","tryWebkitApproach","setTimeout","handleOpera","handleFirefox","useIntent","launch_app_or_alt_url","el","setInterval","encodeURI","g_intent","click","BestPint","preventDefault"],"mappings":"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","file":"bestpint.js","sourcesContent":["'use strict';\nvar Bestpint = Bestpint || {};\nBestpint.config = function () {\n    this.entries = {};\n    this.device_lat = 0;\n    this.device_long = 0;\n    //http://joaopereirawd.github.io/fakeLoader.js/\n    this.fakeloader = $('#fakeloader');\n    this.map_wrapper = $('#map-canvas');\n    this.proxy_error_wrapper = $('#proxy-error');\n    this.fakeloader.fakeLoader({\n        timeToHide: 1000000,\n        bgColor: '#333',\n        spinner: 'spinner1'\n    });\n};","'use strict';\nvar Bestpint = Bestpint || {};\nBestpint.createInfoWindowContent = function(the_entry) {\n\n    var entry = the_entry;\n    var html = '';\n\n    //replace missing images (and the horrible ec+ placeholder) with nice placeholder\n    if (entry.ecplus_Beer_ctrl7 === undefined || entry.ecplus_Beer_ctrl7.indexOf('thumbnail=true') > -1) {\n        entry.ecplus_Beer_ctrl7 = 'img/placeholder.png';\n    }\n\n\n    html += '<table class=\"infoWindow table-striped table-bordered table-condensed\">';\n    html += '<thead><tr><th colspan=\"2\" class=\"text-center\">' + (entry.ecplus_Beer_ctrl6 || '') + '</th></tr></thead>';\n    html += '<tbody>';\n\n\n    //let's do it manually as we kow all the fields\n\n    //name of the place\n    html += '<tr>';\n    html += '<td>' + Bestpint.project.ecplus_Beer_ctrl13 + '</td>';\n    html += '<td>' + (entry.ecplus_Beer_ctrl13 || '') + '</td>';\n    html += '</tr>';\n\n    //type of place\n    html += '<tr>';\n    html += '<td>' + Bestpint.project.ecplus_Place_ctrl4.key + '</td>';\n    html += '<td>' + (Bestpint.project.ecplus_Place_ctrl4.values[entry.ecplus_Place_ctrl4] || '') + '</td>';\n    html += '</tr>';\n\n    //Name of beer\n    html += '<tr>';\n    html += '<td>' + Bestpint.project.ecplus_Beer_ctrl6 + '</td>';\n    html += '<td>' + (entry.ecplus_Beer_ctrl6 || '') + '</td>';\n    html += '</tr>';\n\n    //Brewery\n    html += '<tr>';\n    html += '<td>' + Bestpint.project.ecplus_Beer_ctrl8 + '</td>';\n    html += '<td>' + (entry.ecplus_Beer_ctrl8 || '') + '</td>';\n    html += '</tr>';\n\n    //Type of beer\n    html += '<tr>';\n    html += '<td>' + Bestpint.project.ecplus_Beer_ctrl9.key + '</td>';\n    html += '<td>' + (Bestpint.project.ecplus_Beer_ctrl9.values[entry.ecplus_Beer_ctrl9] || '') + '</td>';\n    html += '</tr>';\n\n\n    //html += '<tr>';\n    //html += '<td colspan=\"2\" class=\"text-center\">' + Bestpint.project.ecplus_Beer_ctrl7 + '</td>';\n    //html += '</tr>';\n    html += '<tr colspan=\"2\">';\n    //set fixed height for table cell to avoid cell resizing messing up the auto panning when infoWindow is open\n    html += '<tr><td colspan=\"2\" class=\"img-wrapper\">';\n    html += '<div class=\"desktop-frame-square\">';\n    html += '<div class=\"crop\">';\n    html += '<i class=\"fa fa-spinner fa-spin fa-3x\"></i>';\n    html += '<img src=\"' + entry.ecplus_Beer_ctrl7 + '\" alt=\"\" title=\"\" width=\"200\">';\n    html += '</div>';\n    html += '</div>';\n    html += '</td></tr>';\n    html += '</tr>';\n\n    //How would you rate it\n    html += '<tr>';\n    html += '<td>' + Bestpint.project.ecplus_Beer_ctrl14.key + '</td>';\n    html += '<td>' + (Bestpint.project.ecplus_Beer_ctrl14.values[entry.ecplus_Beer_ctrl14] || '') + '</td>';\n    html += '</tr>';\n\n    //how is the price range\n    html += '<tr>';\n    html += '<td>' + Bestpint.project.ecplus_Beer_ctrl11.key + '</td>';\n    html += '<td>' + (Bestpint.project.ecplus_Beer_ctrl11.values[entry.ecplus_Beer_ctrl11] || '') + '</td>';\n    html += '</tr>';\n\n    //price and currency\n    html += '<tr>';\n    html += '<td>' + Bestpint.project.ecplus_Beer_ctrl12 + '</td>';\n    html += '<td>' + (entry.ecplus_Beer_ctrl12 || '') + '</td>';\n    html += '</tr>';\n\n    //Any comments?\n    html += '<tr>';\n    html += '<td>' + Bestpint.project.ecplus_Place_ctrl5 + '</td>';\n    html += '<td>' + (entry.ecplus_Place_ctrl5 || '') + '</td>';\n    html += '</tr>';\n\n    html += '</tbody>';\n    html += '</table>';\n\n    return html;\n}","'use strict';\nvar Bestpint = Bestpint || {};\nBestpint.createMobileInfoContent = function (the_entry) {\n\n    var entry = the_entry;\n    var html = '';\n\n    //replace missing images (and the horrible ec+ placeholder) with nice placeholder\n    if (entry.ecplus_Beer_ctrl7 === undefined || entry.ecplus_Beer_ctrl7.indexOf('thumbnail=true') > -1 || entry.ecplus_Beer_ctrl7 === '') {\n        entry.ecplus_Beer_ctrl7 = 'img/placeholder.png';\n    }\n\n    html += '<table class=\"mobile-info-window table-condensed table-bordered table-striped\">';\n    html += '<thead><tr><th colspan=\"2\" class=\"text-center\">' + (entry.ecplus_Beer_ctrl6 || '') + ', ' + (entry.ecplus_Beer_ctrl13 || '') + '</th></tr></thead>';\n    html += '<tbody>';\n\n    //How would you rate it\n    html += '<tr>';\n    html += '<td>' + Bestpint.project.ecplus_Beer_ctrl14.key + '</td>';\n    html += '<td>' + (Bestpint.project.ecplus_Beer_ctrl14.values[entry.ecplus_Beer_ctrl14] || '') + '</td>';\n    html += '</tr>';\n\n    html += '<tr>';\n    html += '<td>' + Bestpint.project.ecplus_Beer_ctrl11.key + '</td>';\n    html += '<td>' + (Bestpint.project.ecplus_Beer_ctrl11.values[entry.ecplus_Beer_ctrl11] || '') + '</td>';\n    html += '</tr>';\n\n\n    html += '<tr><td colspan=\"2\" class=\"img-wrapper\">';\n    html += '<div class=\"frame-square\">';\n    html += '<div class=\"crop\">';\n    html += '<i class=\"fa fa-spinner fa-spin fa-3x\"></i>';\n    html += '<img src=\"' + entry.ecplus_Beer_ctrl7 + '\" alt=\"\" title=\"small wide image\">';\n    html += '</div>';\n    html += '</div>';\n    html += '</td></tr>';\n\n    html += '</tbody>';\n    html += '</table>';\n\n\n    return html;\n};","'use strict';\nvar Bestpint = Bestpint || {};\nBestpint.getData = function () {\n\n    var deferred = new $.Deferred();\n    var url = 'http://plus.epicollect.net/Bestpint/Beer.json';\n\n    //try a cors request to epicollect server using yql https://developer.yahoo.com/yql\n    $.getJSON(\"http://query.yahooapis.com/v1/public/yql\",\n        {\n            q: \"select * from json where url='http://plus.epicollect.net/Bestpint/Beer.json'\",\n            format: \"json\"\n        },\n        function (data, status) {\n            //if the proxy is down for some reasons, show error message\n            if (data.query.results) {\n                //console.log(data.query.results.json.json);\n                deferred.resolve(data.query.results.json.json);\n            }\n            else {\n                deferred.reject(status);\n            }\n        });\n    return deferred.promise();\n};","'use strict';\nvar Bestpint = Bestpint || {};\nBestpint.init = function () {\n    //request data from Epicollect+ via a proxy\n    $.when(Bestpint.getData()).then(function (response) {\n\n        Bestpint.entries = response;\n        //get user location (on mobile only) to give just the entries around the area\n        if (Bestpint.isMobile.any()) {\n            //get device position before init map\n            navigator.geolocation.getCurrentPosition(function (position) {\n                Bestpint.device_lat = position.coords.latitude;\n                Bestpint.device_long = position.coords.longitude;\n                Bestpint.initialiseMap();\n            }, function (error) {\n                console.log(error);\n                Bestpint.initialiseMap();\n            });\n        }\n        else {\n            //init maps on desktop\n            Bestpint.initialiseMap();\n        }\n    }, function (error) {\n        //show error message, request failed\n        console.log(error);\n        Bestpint.map_wrapper.hide();\n        Bestpint.proxy_error_wrapper.removeClass('hidden');\n        Bestpint.fakeloader.fadeOut();\n    });\n};\n","/* global L*/\n'use strict';\nvar Bestpint = Bestpint || {};\nBestpint.initialiseMap = function () {\n\n    var is_device = Bestpint.isMobile.any();\n    var map;\n    var tiles;\n    var cluster;\n\n    var map_options = {\n        center: {lat: 0, lng: 0},\n        zoom: 6,\n        zoomControl: is_device ? false : true\n        //disableDefaultUI: is_device ? true : false\n    };\n\n    var image = L.icon({\n        iconUrl: 'img/marker-icon.png',\n        iconSize: [32, 32],\n        iconAnchor: [16, 16]\n    });\n\n    if (is_device) {\n        //hack to make map show on Chrome Android\n        Bestpint.map_wrapper.height('100vh');\n    }\n\n    //set default images path since we are using a custom location\n    L.Icon.Default.imagePath = './img/leaflet/';\n\n    // initialize the map on the \"map\" div with a given center and zoom\n    map = L.map('map-canvas', map_options);\n    //  map.addControl(L.control.zoom({position: 'bottomleft'}));\n    tiles = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n        attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n    }).addTo(map);\n\n    ////center popup when it is open\n    map.on('popupopen', function (e) {\n        var px = map.project(e.popup._latlng); // find the pixel location on the map where the popup anchor is\n        px.y -= e.popup._container.clientHeight / 2;// find the height of the popup container, divide by 2, subtract from the Y axis of marker location\n        map.panTo(map.unproject(px), {animate: true}); // pan to new center\n    });\n\n    function addMarkers() {\n\n        var i;\n        var iLength = Bestpint.entries.length;\n        var marker;\n        var position;\n        var coords = [];\n\n\n        cluster = new L.MarkerClusterGroup({showCoverageOnHover: false, maxClusterRadius: 10});\n\n        for (i = 0; i < iLength; i++) {\n\n            // console.log(entries[i].ecplus_Place_ctrl3.latitude, ', ' + entries[i].ecplus_Place_ctrl3.longitude);\n\n            if (Bestpint.entries[i].ecplus_Place_ctrl3.latitude !== \"\") {\n\n\n                marker = L.marker([Bestpint.entries[i].ecplus_Place_ctrl3.latitude, Bestpint.entries[i].ecplus_Place_ctrl3.longitude], {icon: image});\n                // marker.addTo(map);\n\n                if (!is_device) {\n                    //on desktop, create full info window content (bootstrap table)\n                    marker.bindPopup(Bestpint.createInfoWindowContent(Bestpint.entries[i]));\n                }\n                else {\n\n                    //on device, show a mobile friendly info window with crucial data only (titles + picture (if any))\n                    marker.bindPopup(Bestpint.createMobileInfoContent(Bestpint.entries[i]), {closeButton: false});\n                }\n\n                coords.push([Bestpint.entries[i].ecplus_Place_ctrl3.latitude, Bestpint.entries[i].ecplus_Place_ctrl3.longitude]);\n                cluster.addLayer(marker);\n            }\n        }\n\n\n        //on desktop, show the whole data set\n        if (!is_device || !(Bestpint.device_lat && Bestpint.device_long)) {\n            //fit bounds to whole data set\n            map.fitBounds(coords, {padding: [50, 50]});\n        }\n        else {\n            //on device, just show the data close to user location and amarker where the user acutally is (30m accuracy)\n\n            position = L.marker([Bestpint.device_lat, Bestpint.device_long]);\n            position.addTo(map);\n            map.fitBounds([[Bestpint.device_lat, Bestpint.device_long]], {padding: [100, 100]});\n            map.setZoom(12, {animate: true});\n        }\n\n        map.addLayer(cluster);\n\n        tiles.on(\"load\", function () {\n            console.log(\"all visible tiles have been loaded\");\n            Bestpint.fakeloader.fadeOut();\n        });\n    }\n\n    addMarkers();\n\n\n};","'use strict';\nvar Bestpint = Bestpint || {};\nBestpint.isMobile = {\n    Android: function () {\n        return navigator.userAgent.match(/Android/i);\n    },\n    BlackBerry: function () {\n        return navigator.userAgent.match(/BlackBerry/i);\n    },\n    iOS: function () {\n        return navigator.userAgent.match(/iPhone|iPad|iPod/i);\n    },\n    Opera: function () {\n        return navigator.userAgent.match(/Opera Mini/i);\n    },\n    Windows: function () {\n        return navigator.userAgent.match(/IEMobile/i);\n    },\n    any: function () {\n        return (this.Android() || this.BlackBerry() || this.iOS() || this.Opera() || this.Windows());\n    }\n};","'use strict';\nvar Bestpint = Bestpint || {};\nBestpint.project = {\n    created: '',\n    ecplus_Beer_ctrl6: 'Name of beer',\n    ecplus_Beer_ctrl7: \"Take a photo of the beer\",\n    ecplus_Beer_ctrl8: \"Brewery\",\n    ecplus_Beer_ctrl9: {\n        key: 'Type of beer',\n        values: {\n            1: 'Ale',\n            2: 'Pale Ale',\n            3: 'IPA',\n            4: 'Porter',\n            5: 'Stout',\n            6: 'Other'\n        }\n    },\n    ecplus_Beer_ctrl11: {\n        key: 'How is the price range?',\n        values: {\n            1: 'Expensive',\n            2: 'Average',\n            3: 'Cheap'\n        }\n    },\n    ecplus_Beer_ctrl12: \"Price and currency?\",\n    ecplus_Beer_ctrl13: \"Name of the place?\",\n    ecplus_Beer_ctrl14: {\n        key: 'How would you rate it?',\n        values: {\n            1: 'Excellent',\n            2: 'Good',\n            3: 'Average',\n            4: 'Fair',\n            5: 'Poor'\n        }\n    },\n    ecplus_Place_ctrl3: \"Location\",\n    ecplus_Place_ctrl4: {\n        key: 'Type of Place',\n        values: {\n            1: 'Pub',\n            2: 'Bar',\n            3: 'Festival',\n            4: 'Exhibition',\n            5: 'Brewery',\n            6: 'Other'\n        }\n    },\n    ecplus_Place_ctrl5: \"Any comments?\"\n\n};","'use strict';\nvar Bestpint = Bestpint || {};\n$(document).ready(function () {\n    //execute Leaflet only on map page\n    var href = window.location.href;\n    if(href.split('/').pop() !== 'map'){\n        return;\n    }\n    else {\n        console.log('Let \\'s display some map');\n        Bestpint.config();\n        Bestpint.init();\n    }\n});\n","/*jslint vars: true , nomen: true devel: true, plusplus: true*/\n/*global $, jQuery, BestPint*/\n(function () {\n    \"use strict\";\n\n    var custom = \"epicollectplus://view?project=\" + encodeURI(\"http://plus.epicollect.net/bestpint.xml\");\n    var ios_uri = \"epicollectplus://project=\" + encodeURI(\"plus.epicollect.net/bestpint.xml\");\n    // var firefox_android_uri = \"http://epicollectplus.imperial.ac.uk?project=\" + encodeURI(\"http://plus.epicollect.net/bestpint.xml\");\n    var alt = \"https://play.google.com/store/apps/details?id=uk.ac.imperial.epicollectplus.html5&hl=en_GB&referrer=\" + encodeURI(\"http://plus.epicollect.net/bestpint.xml\");\n\n    //TODO: check this intent syntax as it might not work, see test button below\n    var g_intent = \"intent:#Intent;action=uk.ac.imperial.epicollectplus.html5.REQUEST_PROJECT;S.project=\";\n    g_intent += encodeURI(\"http://plus.epicollect.net/bestpint.xml\");\n    g_intent += \";S.referrer=\";\n    g_intent += encodeURI(\"http://plus.epicollect.net/bestpint.xml\");\n    g_intent += \";package=uk.ac.imperial.epicollectplus.html5;launchFlags=268435456;end\";\n\n    var timer;\n    var heartbeat;\n    var iframe_timer;\n\n    function clearTimers() {\n        clearTimeout(timer);\n        clearTimeout(heartbeat);\n        clearTimeout(iframe_timer);\n    }\n\n    //clear timers and stop everything if the web page is not visible anymore\n    //which means either the Play Store or the app are on the foreground\n    function intervalHeartbeat() {\n        if (document.webkitHidden || document.hidden) {\n            clearTimers();\n            document.location = \"http://bestpint.net\";\n        }\n    }\n\n    //old browser use the iframe approach (https://developer.chrome.com/multidevice/android/intents)\n    function tryIframeApproach() {\n        var iframe = document.createElement(\"iframe\");\n        iframe.style.border = \"none\";\n        iframe.style.width = \"1px\";\n        iframe.style.height = \"1px\";\n        iframe.onload = function () {\n            document.location = alt;\n        };\n        iframe.src = custom;\n        document.body.appendChild(iframe);\n    }\n\n    /*\n     * Some webkit browsers can handle the scheme, showing an error.\n     * the timeout will load the Play Store page (I tested this on Firefox only,\n     * which displayes a toast warning)\n     */\n    function tryWebkitApproach() {\n       // document.location = custom;\n        document.location = \"epicollectplus://project?plus.epicollect.net/bestpint.xml\";\n        timer = setTimeout(function () {\n            document.location = alt;\n        }, 2000);\n    }\n\n    /**\n     * handle Opera browser, showing app chooser\n     * (hopefully the user will open the Play Store, duh!)\n     *\n     */\n    function handleOpera() {\n        document.location = alt;\n    }\n\n    /*\n     * Handle Firefox browser and its crazy behaviour\n     * look here https://support.mozilla.org/en-US/questions/977330\n     */\n    function handleFirefox() {\n        //does not work\n        //document.location = firefox_android_uri;\n\n        //works\n        document.location = alt;\n    }\n\n    /*\n     * Use Chrome intent, work on 25+, not sure what happens on <25\n     * as I cannot test... Chrome for Android 25 was released in February 2013\n     * https://developer.chrome.com/multidevice/android/intents\n     */\n    function useIntent() {\n\n        tryWebkitApproach();\n       // window.location = g_intent;\n    }\n\n    function launch_app_or_alt_url(el) {\n\n        //continue to check if the page is still on the foreground\n        heartbeat = setInterval(intervalHeartbeat, 200);\n\n        //use Chrome intent (on Chrome > 25 it works)\n        if (navigator.userAgent.match(/Chrome/)) {\n            //alert(navigator.userAgent);\n\n            //is Opera? The new builds use Chrome but intents do not work!\n            if (navigator.userAgent.match(/Opera|OPR\\//)) {\n\n                //let's handle Opera browser showing the app chooser\n                handleOpera();\n            } else {\n                useIntent();\n            }\n\n        } else if (navigator.userAgent.match(/Firefox/) || navigator.userAgent.match(/Opera/)) {\n\n            //handle Firefox\n            if (navigator.userAgent.match(/Firefox/)) {\n                handleFirefox();\n            } else {\n                //Old Opera, try webkit approach, if that fails, go for the iFrame approach\n                tryWebkitApproach();\n                iframe_timer = setTimeout(function () {\n                    tryIframeApproach();\n                }, 1500);\n            }\n\n        } else {\n            // alert(\"iframe?\");\n            //Old Opera, try webkit approach, if that fails, go for the iFrame approach\n            tryWebkitApproach();\n            iframe_timer = setTimeout(function () {\n                tryIframeApproach();\n            }, 1500);\n        }\n    }\n\n\n    $(\".source_url\").click(function (e) {\n        //alert(navigator.userAgent);\n\n        if (BestPint.isMobile.Android()) {\n            //handle Android here\n            launch_app_or_alt_url($(this));\n\n        } else if (BestPint.isMobile.iOS()) {\n\n            //handle iOS (iPhone, iPad) here\n\n            //if app not installed, redirect\n            //TODO: test this with real link when app will be published\n            // how to : http://stackoverflow.com/questions/433907/how-to-link-to-apps-on-the-app-store\n            setTimeout(function () {\n                window.location = \"itms://itunes.apple.com/us/app/kaon-v-stream/id378890806?mt=8&uo=4\";\n            }, 25);\n\n            //if the app is installed, it will open\n            //document.location = ios_uri;\n            //TODO:\n            //testing this here as Safari on i8 doe not want '=' or ':' in the URL\n            document.location = \"epicollectplus://project?plus.epicollect.net/bestpint.xml\";\n            //window.location.href = \"epicollectplus://project?123456\";\n        }\n\n        e.preventDefault();\n    });\n\n    //handle click on download app button, to redirect to App Store or Google Play\n    //TODO\n\n}());\n\n"],"sourceRoot":"/source/"}