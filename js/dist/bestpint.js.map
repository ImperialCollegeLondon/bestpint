{"version":3,"sources":["app.js","custom_url.js","mobile_detection.js"],"names":["$","document","ready","_createInfoWindowContent","the_entry","entry","html","undefined","ecplus_Beer_ctrl7","indexOf","ecplus_Beer_ctrl6","bestpint","ecplus_Beer_ctrl13","ecplus_Place_ctrl4","key","values","ecplus_Beer_ctrl8","ecplus_Beer_ctrl9","ecplus_Beer_ctrl14","ecplus_Beer_ctrl11","ecplus_Beer_ctrl12","ecplus_Place_ctrl5","_createMobileInfoContent","initialize","addMarkers","i","marker","position","iLength","entries","length","coords","cluster","L","MarkerClusterGroup","showCoverageOnHover","maxClusterRadius","ecplus_Place_ctrl3","latitude","longitude","icon","image","is_device","bindPopup","closeButton","push","addLayer","device_lat","device_long","addTo","map","fitBounds","padding","setZoom","animate","tiles","on","console","log","fakeloader","fadeOut","height","mapOptions","center","lat","lng","zoom","zoomControl","Icon","Default","imagePath","tileLayer","attribution","e","px","project","popup","_latlng","y","_container","clientHeight","panTo","unproject","isMobile","Android","navigator","userAgent","match","BlackBerry","iOS","Opera","Windows","any","created",1,2,3,4,5,6,"iconUrl","iconSize","iconAnchor","fakeLoader","timeToHide","bgColor","spinner","hide","getJSON","q","format","data","status","query","results","json","onPosSuccess","onPosError","error","geolocation","getCurrentPosition","removeClass","clearTimers","clearTimeout","timer","heartbeat","iframe_timer","intervalHeartbeat","webkitHidden","hidden","location","tryIframeApproach","iframe","createElement","style","border","width","onload","alt","src","custom","body","appendChild","tryWebkitApproach","setTimeout","handleOpera","handleFirefox","useIntent","launch_app_or_alt_url","el","setInterval","encodeURI","g_intent","click","BestPint","this","window","preventDefault","module"],"mappings":"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","file":"bestpint.js","sourcesContent":["/* global L, $ */\n$(document).ready(function () {\n    'use strict';\n\n    console.log('Let \\'s display some map');\n    var url = 'http://plus.epicollect.net/Bestpint/Beer.json';\n    var fakeloader;\n    var entries;\n    var map;\n    var mapOptions;\n    var is_device;\n    var device_lat;\n    var device_long;\n    var cluster;\n    var tiles;\n\n    var isMobile = {\n        Android: function () {\n            return navigator.userAgent.match(/Android/i);\n        },\n        BlackBerry: function () {\n            return navigator.userAgent.match(/BlackBerry/i);\n        },\n        iOS: function () {\n            return navigator.userAgent.match(/iPhone|iPad|iPod/i);\n        },\n        Opera: function () {\n            return navigator.userAgent.match(/Opera Mini/i);\n        },\n        Windows: function () {\n            return navigator.userAgent.match(/IEMobile/i);\n        },\n        any: function () {\n            return (isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows());\n        }\n    };\n\n    var bestpint = {\n        created: '',\n        ecplus_Beer_ctrl6: 'Name of beer',\n        ecplus_Beer_ctrl7: \"Take a photo of the beer\",\n        ecplus_Beer_ctrl8: \"Brewery\",\n        ecplus_Beer_ctrl9: {\n            key: 'Type of beer',\n            values: {\n                1: 'Ale',\n                2: 'Pale Ale',\n                3: 'IPA',\n                4: 'Porter',\n                5: 'Stout',\n                6: 'Other'\n            }\n        },\n        ecplus_Beer_ctrl11: {\n            key: 'How is the price range?',\n            values: {\n                1: 'Expensive',\n                2: 'Average',\n                3: 'Cheap'\n            }\n        },\n        ecplus_Beer_ctrl12: \"Price and currency?\",\n        ecplus_Beer_ctrl13: \"Name of the place?\",\n        ecplus_Beer_ctrl14: {\n            key: 'How would you rate it?',\n            values: {\n                1: 'Excellent',\n                2: 'Good',\n                3: 'Average',\n                4: 'Fair',\n                5: 'Poor'\n            }\n        },\n        ecplus_Place_ctrl3: \"Location\",\n        ecplus_Place_ctrl4: {\n            key: 'Type of Place',\n            values: {\n                1: 'Pub',\n                2: 'Bar',\n                3: 'Festival',\n                4: 'Exhibition',\n                5: 'Brewery',\n                6: 'Other'\n            }\n        },\n        ecplus_Place_ctrl5: \"Any comments?\"\n\n    };\n\n    var image = L.icon({\n        iconUrl: 'img/marker-icon.png',\n        // size: new google.maps.Size(128, 128),\n\n        //size to be displayed (down from orignal 128 x128)\n        iconSize: [32, 32],\n\n        //origin of the image is 0,0 top left\n        //  origin: new google.maps.Point(0, 0),\n        //specify the anchor based on the scaled image (i.e keep the image centerd over the lat,long location otherwise it shifts)\n        iconAnchor: [16, 16]\n    });\n\n    //http://joaopereirawd.github.io/fakeLoader.js/\n    fakeloader = $('#fakeloader');\n    fakeloader.fakeLoader({\n        timeToHide: 1000000,\n        bgColor: '#333',\n        spinner: 'spinner1'\n    });\n\n    $('#proxy-error').hide();\n\n\n    function _createInfoWindowContent(the_entry) {\n\n        var entry = the_entry;\n        var html = '';\n\n        //replace missing images (and the horrible ec+ placeholder) with nice placeholder\n        if (entry.ecplus_Beer_ctrl7 === undefined || entry.ecplus_Beer_ctrl7.indexOf('thumbnail=true') > -1) {\n            entry.ecplus_Beer_ctrl7 = 'img/placeholder.png';\n        }\n\n\n        html += '<table class=\"infoWindow table-striped table-bordered table-condensed\">';\n        html += '<thead><tr><th colspan=\"2\" class=\"text-center\">' + (entry.ecplus_Beer_ctrl6 || '') + '</th></tr></thead>';\n        html += '<tbody>';\n\n\n        //let's do it manually as we kow all the fields\n\n        //name of the place\n        html += '<tr>';\n        html += '<td>' + bestpint.ecplus_Beer_ctrl13 + '</td>';\n        html += '<td>' + (entry.ecplus_Beer_ctrl13 || '') + '</td>';\n        html += '</tr>';\n\n        //type of place\n        html += '<tr>';\n        html += '<td>' + bestpint.ecplus_Place_ctrl4.key + '</td>';\n        html += '<td>' + (bestpint.ecplus_Place_ctrl4.values[entry.ecplus_Place_ctrl4] || '') + '</td>';\n        html += '</tr>';\n\n        //Name of beer\n        html += '<tr>';\n        html += '<td>' + bestpint.ecplus_Beer_ctrl6 + '</td>';\n        html += '<td>' + (entry.ecplus_Beer_ctrl6 || '') + '</td>';\n        html += '</tr>';\n\n        //Brewery\n        html += '<tr>';\n        html += '<td>' + bestpint.ecplus_Beer_ctrl8 + '</td>';\n        html += '<td>' + (entry.ecplus_Beer_ctrl8 || '') + '</td>';\n        html += '</tr>';\n\n        //Type of beer\n        html += '<tr>';\n        html += '<td>' + bestpint.ecplus_Beer_ctrl9.key + '</td>';\n        html += '<td>' + (bestpint.ecplus_Beer_ctrl9.values[entry.ecplus_Beer_ctrl9] || '') + '</td>';\n        html += '</tr>';\n\n\n        //html += '<tr>';\n        //html += '<td colspan=\"2\" class=\"text-center\">' + bestpint.ecplus_Beer_ctrl7 + '</td>';\n        //html += '</tr>';\n        html += '<tr colspan=\"2\">';\n        //set fixed height for table cell to avoid cell resizing messing up the auto panning when infoWindow is open\n        html += '<tr><td colspan=\"2\" class=\"img-wrapper\">';\n        html += '<div class=\"desktop-frame-square\">';\n        html += '<div class=\"crop\">';\n        html += '<i class=\"fa fa-spinner fa-spin fa-3x\"></i>';\n        html += '<img src=\"' + entry.ecplus_Beer_ctrl7 + '\" alt=\"\" title=\"\" width=\"200\">';\n        html += '</div>';\n        html += '</div>';\n        html += '</td></tr>';\n        html += '</tr>';\n\n        //How would you rate it\n        html += '<tr>';\n        html += '<td>' + bestpint.ecplus_Beer_ctrl14.key + '</td>';\n        html += '<td>' + (bestpint.ecplus_Beer_ctrl14.values[entry.ecplus_Beer_ctrl14] || '') + '</td>';\n        html += '</tr>';\n\n        //how is the price range\n        html += '<tr>';\n        html += '<td>' + bestpint.ecplus_Beer_ctrl11.key + '</td>';\n        html += '<td>' + (bestpint.ecplus_Beer_ctrl11.values[entry.ecplus_Beer_ctrl11] || '') + '</td>';\n        html += '</tr>';\n\n        //price and currency\n        html += '<tr>';\n        html += '<td>' + bestpint.ecplus_Beer_ctrl12 + '</td>';\n        html += '<td>' + (entry.ecplus_Beer_ctrl12 || '') + '</td>';\n        html += '</tr>';\n\n        //Any comments?\n        html += '<tr>';\n        html += '<td>' + bestpint.ecplus_Place_ctrl5 + '</td>';\n        html += '<td>' + (entry.ecplus_Place_ctrl5 || '') + '</td>';\n        html += '</tr>';\n\n        html += '</tbody>';\n        html += '</table>';\n\n        return html;\n    }\n\n    function _createMobileInfoContent(the_entry) {\n\n        var entry = the_entry;\n        var html = '';\n\n        //replace missing images (and the horrible ec+ placeholder) with nice placeholder\n        if (entry.ecplus_Beer_ctrl7 === undefined || entry.ecplus_Beer_ctrl7.indexOf('thumbnail=true') > -1 || entry.ecplus_Beer_ctrl7 === '') {\n            entry.ecplus_Beer_ctrl7 = 'img/placeholder.png';\n        }\n\n        html += '<table class=\"mobile-info-window table-condensed table-bordered table-striped\">';\n        html += '<thead><tr><th colspan=\"2\" class=\"text-center\">' + (entry.ecplus_Beer_ctrl6 || '') + ', ' + (entry.ecplus_Beer_ctrl13 || '') + '</th></tr></thead>';\n        html += '<tbody>';\n\n        //How would you rate it\n        html += '<tr>';\n        html += '<td>' + bestpint.ecplus_Beer_ctrl14.key + '</td>';\n        html += '<td>' + (bestpint.ecplus_Beer_ctrl14.values[entry.ecplus_Beer_ctrl14] || '') + '</td>';\n        html += '</tr>';\n\n        html += '<tr>';\n        html += '<td>' + bestpint.ecplus_Beer_ctrl11.key + '</td>';\n        html += '<td>' + (bestpint.ecplus_Beer_ctrl11.values[entry.ecplus_Beer_ctrl11] || '') + '</td>';\n        html += '</tr>';\n\n\n        html += '<tr><td colspan=\"2\" class=\"img-wrapper\">';\n        html += '<div class=\"frame-square\">';\n        html += '<div class=\"crop\">';\n        html += '<i class=\"fa fa-spinner fa-spin fa-3x\"></i>';\n        html += '<img src=\"' + entry.ecplus_Beer_ctrl7 + '\" alt=\"\" title=\"small wide image\">';\n        html += '</div>';\n        html += '</div>';\n        html += '</td></tr>';\n\n        html += '</tbody>';\n        html += '</table>';\n\n\n        return html;\n    }\n\n    function initialize() {\n\n        if (is_device) {\n            $('#map-canvas').height('100vh');\n        }\n\n        mapOptions = {\n            center: {lat: 0, lng: 0},\n            zoom: 6,\n            zoomControl: is_device ? false : true\n            //disableDefaultUI: is_device ? true : false\n        };\n\n        //set default images path since we are using a custom location\n        L.Icon.Default.imagePath = './img/leaflet/';\n\n        // initialize the map on the \"map\" div with a given center and zoom\n        map = L.map('map-canvas', mapOptions);\n        //  map.addControl(L.control.zoom({position: 'bottomleft'}));\n        tiles = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n            attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n        }).addTo(map);\n\n        ////center popup when it is open\n        map.on('popupopen', function (e) {\n            var px = map.project(e.popup._latlng); // find the pixel location on the map where the popup anchor is\n            px.y -= e.popup._container.clientHeight / 2;// find the height of the popup container, divide by 2, subtract from the Y axis of marker location\n            map.panTo(map.unproject(px), {animate: true}); // pan to new center\n        });\n\n        function addMarkers() {\n\n            var i;\n            var iLength = entries.length;\n            var marker;\n            var position;\n            var coords = [];\n\n\n            cluster = new L.MarkerClusterGroup({showCoverageOnHover: false, maxClusterRadius: 10});\n\n            for (i = 0; i < iLength; i++) {\n\n                // console.log(entries[i].ecplus_Place_ctrl3.latitude, ', ' + entries[i].ecplus_Place_ctrl3.longitude);\n\n                if (entries[i].ecplus_Place_ctrl3.latitude !== \"\") {\n\n\n                    marker = L.marker([entries[i].ecplus_Place_ctrl3.latitude, entries[i].ecplus_Place_ctrl3.longitude], {icon: image});\n                    // marker.addTo(map);\n\n                    if (!is_device) {\n                        //on desktop, create full info window content (bootstrap table)\n                        marker.bindPopup(_createInfoWindowContent(entries[i]));\n                    }\n                    else {\n\n                        //on device, show a mobile friendly info window with crucial data only (titles + picture (if any))\n                        marker.bindPopup(_createMobileInfoContent(entries[i]), {closeButton: false});\n                    }\n\n                    coords.push([entries[i].ecplus_Place_ctrl3.latitude, entries[i].ecplus_Place_ctrl3.longitude]);\n                    cluster.addLayer(marker);\n                }\n            }\n\n\n            //on desktop, show the whole data set\n            if (!is_device || !(device_lat && device_long)) {\n                //fit bounds to whole data set\n                map.fitBounds(coords, {padding: [50, 50]});\n            }\n            else {\n                //on device, just show the data close to user location and amarker where the user acutally is (30m accuracy)\n\n                position = L.marker([device_lat, device_long]);\n                position.addTo(map);\n                map.fitBounds([[device_lat, device_long]], {padding: [100, 100]});\n                map.setZoom(12, {animate: true});\n            }\n\n            map.addLayer(cluster);\n\n            tiles.on(\"load\", function () {\n                console.log(\"all visible tiles have been loaded\");\n                fakeloader.fadeOut();\n            });\n        }\n        addMarkers();\n    }\n\n    is_device = isMobile.any();\n\n\n///try a cors request to epicollect server using yql https://developer.yahoo.com/yql\n    $.getJSON(\"http://query.yahooapis.com/v1/public/yql\",\n        {\n            q: \"select * from json where url='http://plus.epicollect.net/Bestpint/Beer.json'\",\n            format: \"json\"\n        },\n        function (data, status) {\n            //console.log(data);\n            console.log(status);\n\n            //if the proxy is down for some reasons, show error message\n            if (data.query.results) {\n\n\n                entries = data.query.results.json.json;\n                console.log(data.query.results.json.json);\n\n                //load test\n                var i;\n                var iLength = 250000;\n                var entry;\n\n\n                //for (i = 0; i < iLength; i++) {\n                //\n                //    entry = entries[Math.floor(Math.random() * 10) + 1];\n                //    entry.ecplus_Place_ctrl3.latitude = chance.latitude();\n                //    entry.ecplus_Place_ctrl3.longitude = chance.longitude();\n                //\n                //    entries.push(entry);\n                //}\n                //console.log('Test with total entries of ' + entries.length);\n\n\n                //get user location (on mobile only) to give just the entries around the area\n                if (is_device) {\n\n                    //get current position first\n                    var onPosSuccess = function (position) {\n\n                        device_lat = position.coords.latitude;\n                        device_long = position.coords.longitude;\n\n                        initialize();\n                    }\n\n                    var onPosError = function (error) {\n                        console.log(error);\n                        initialize();\n                    }\n\n                    navigator.geolocation.getCurrentPosition(onPosSuccess, onPosError);\n\n\n                }\n                else {\n                    //display entries on map\n                    //init maps\n                    initialize();\n                }\n            }\n            else {\n\n                $('#map-canvas').hide();\n                $('#proxy-error').removeClass('hidden');\n                fakeloader.fadeOut();\n            }\n        });\n});\n","/*jslint vars: true , nomen: true devel: true, plusplus: true*/\n/*global $, jQuery, BestPint*/\n(function () {\n    \"use strict\";\n\n    var custom = \"epicollectplus://view?project=\" + encodeURI(\"http://plus.epicollect.net/bestpint.xml\");\n    var ios_uri = \"epicollectplus://project=\" + encodeURI(\"plus.epicollect.net/bestpint.xml\");\n    // var firefox_android_uri = \"http://epicollectplus.imperial.ac.uk?project=\" + encodeURI(\"http://plus.epicollect.net/bestpint.xml\");\n    var alt = \"https://play.google.com/store/apps/details?id=uk.ac.imperial.epicollectplus.html5&hl=en_GB&referrer=\" + encodeURI(\"http://plus.epicollect.net/bestpint.xml\");\n\n    //TODO: check this intent syntax as it might not work, see test button below\n    var g_intent = \"intent:#Intent;action=uk.ac.imperial.epicollectplus.html5.REQUEST_PROJECT;S.project=\";\n    g_intent += encodeURI(\"http://plus.epicollect.net/bestpint.xml\");\n    g_intent += \";S.referrer=\";\n    g_intent += encodeURI(\"http://plus.epicollect.net/bestpint.xml\");\n    g_intent += \";package=uk.ac.imperial.epicollectplus.html5;launchFlags=268435456;end\";\n\n    var timer;\n    var heartbeat;\n    var iframe_timer;\n\n    function clearTimers() {\n        clearTimeout(timer);\n        clearTimeout(heartbeat);\n        clearTimeout(iframe_timer);\n    }\n\n    //clear timers and stop everything if the web page is not visible anymore\n    //which means either the Play Store or the app are on the foreground\n    function intervalHeartbeat() {\n        if (document.webkitHidden || document.hidden) {\n            clearTimers();\n            document.location = \"http://bestpint.net\";\n        }\n    }\n\n    //old browser use the iframe approach (https://developer.chrome.com/multidevice/android/intents)\n    function tryIframeApproach() {\n        var iframe = document.createElement(\"iframe\");\n        iframe.style.border = \"none\";\n        iframe.style.width = \"1px\";\n        iframe.style.height = \"1px\";\n        iframe.onload = function () {\n            document.location = alt;\n        };\n        iframe.src = custom;\n        document.body.appendChild(iframe);\n    }\n\n    /*\n     * Some webkit browsers can handle the scheme, showing an error.\n     * the timeout will load the Play Store page (I tested this on Firefox only,\n     * which displayes a toast warning)\n     */\n    function tryWebkitApproach() {\n       // document.location = custom;\n        document.location = \"epicollectplus://project?plus.epicollect.net/bestpint.xml\";\n        timer = setTimeout(function () {\n            document.location = alt;\n        }, 2000);\n    }\n\n    /**\n     * handle Opera browser, showing app chooser\n     * (hopefully the user will open the Play Store, duh!)\n     *\n     */\n    function handleOpera() {\n        document.location = alt;\n    }\n\n    /*\n     * Handle Firefox browser and its crazy behaviour\n     * look here https://support.mozilla.org/en-US/questions/977330\n     */\n    function handleFirefox() {\n        //does not work\n        //document.location = firefox_android_uri;\n\n        //works\n        document.location = alt;\n    }\n\n    /*\n     * Use Chrome intent, work on 25+, not sure what happens on <25\n     * as I cannot test... Chrome for Android 25 was released in February 2013\n     * https://developer.chrome.com/multidevice/android/intents\n     */\n    function useIntent() {\n\n        tryWebkitApproach();\n       // window.location = g_intent;\n    }\n\n    function launch_app_or_alt_url(el) {\n\n        //continue to check if the page is still on the foreground\n        heartbeat = setInterval(intervalHeartbeat, 200);\n\n        //use Chrome intent (on Chrome > 25 it works)\n        if (navigator.userAgent.match(/Chrome/)) {\n            //alert(navigator.userAgent);\n\n            //is Opera? The new builds use Chrome but intents do not work!\n            if (navigator.userAgent.match(/Opera|OPR\\//)) {\n\n                //let's handle Opera browser showing the app chooser\n                handleOpera();\n            } else {\n                useIntent();\n            }\n\n        } else if (navigator.userAgent.match(/Firefox/) || navigator.userAgent.match(/Opera/)) {\n\n            //handle Firefox\n            if (navigator.userAgent.match(/Firefox/)) {\n                handleFirefox();\n            } else {\n                //Old Opera, try webkit approach, if that fails, go for the iFrame approach\n                tryWebkitApproach();\n                iframe_timer = setTimeout(function () {\n                    tryIframeApproach();\n                }, 1500);\n            }\n\n        } else {\n            // alert(\"iframe?\");\n            //Old Opera, try webkit approach, if that fails, go for the iFrame approach\n            tryWebkitApproach();\n            iframe_timer = setTimeout(function () {\n                tryIframeApproach();\n            }, 1500);\n        }\n    }\n\n\n    $(\".source_url\").click(function (e) {\n        //alert(navigator.userAgent);\n\n        if (BestPint.isMobile.Android()) {\n            //handle Android here\n            launch_app_or_alt_url($(this));\n\n        } else if (BestPint.isMobile.iOS()) {\n\n            //handle iOS (iPhone, iPad) here\n\n            //if app not installed, redirect\n            //TODO: test this with real link when app will be published\n            // how to : http://stackoverflow.com/questions/433907/how-to-link-to-apps-on-the-app-store\n            setTimeout(function () {\n                window.location = \"itms://itunes.apple.com/us/app/kaon-v-stream/id378890806?mt=8&uo=4\";\n            }, 25);\n\n            //if the app is installed, it will open\n            //document.location = ios_uri;\n            //TODO:\n            //testing this here as Safari on i8 doe not want '=' or ':' in the URL\n            document.location = \"epicollectplus://project?plus.epicollect.net/bestpint.xml\";\n            //window.location.href = \"epicollectplus://project?123456\";\n        }\n\n        e.preventDefault();\n    });\n\n    //handle click on download app button, to redirect to App Store or Google Play\n    //TODO\n\n}());\n\n","var BestPint = BestPint || {};\n\nBestPint = ( function(module) {\"use strict\";\n\n        module.isMobile = {\n            Android : function() {\n                return navigator.userAgent.match(/Android/i);\n            },\n            BlackBerry : function() {\n                return navigator.userAgent.match(/BlackBerry/i);\n            },\n            iOS : function() {\n                return navigator.userAgent.match(/iPhone|iPad|iPod/i);\n            },\n            Opera : function() {\n                return navigator.userAgent.match(/Opera Mini/i);\n            },\n            Windows : function() {\n                return navigator.userAgent.match(/IEMobile/i);\n            },\n            any : function() {\n                return (this.Android() || this.BlackBerry() || this.iOS() || this.Opera() || this.Windows());\n            }\n        };\n\n        return module;\n\n    }(BestPint));\n\n"],"sourceRoot":"/source/"}